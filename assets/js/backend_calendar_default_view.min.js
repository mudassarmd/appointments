window.BackendCalendarDefaultView=window.BackendCalendarDefaultView||{},function(e){"use strict";var b,w="provider",f="service";function v(){var e=window.innerHeight-$("#footer").outerHeight()-$("#header").outerHeight()-$("#calendar-toolbar").outerHeight()-60;return 500<e?e:500}function l(e){if(!e.data||!e.data.notes)return"-";var a=e.data.notes;return 100<a.length?a.substring(0,100)+"...":a}function g(e,a){var t,n;$(".popover").popover("dispose");var s=$(a.target.offsetParent),i=$(a.target).parents().eq(1),r=$(this).hasClass("fc-pending-approval")||s.hasClass("fc-pending-approval")||i.hasClass("fc-pending-approval")?(t=(s.hasClass("fc-custom")||i.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.edit?"mr-2":"d-none",n=(s.hasClass("fc-custom")||i.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.delete?"mr-2":"d-none","admin"==GlobalVariables.user.role_slug?$("<div/>",{html:[$("<strong/>",{class:"d-inline-block mr-2",text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.start.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.end.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.notes}),$("<span/>",{text:l(e)}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary "+n,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:"Reject"})]}),$("<button/>",{class:"edit-popover btn btn-primary "+t,html:[$("<i/>",{class:"fas fa-check mr-2"}),$("<span/>",{text:"Approve"})]})]})]}):$("<div/>",{html:[$("<strong/>",{class:"d-inline-block mr-2",text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.start.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.end.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.notes}),$("<span/>",{text:l(e)}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary "+n,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:"Delete"})]})]})]})):$(this).hasClass("fc-unavailable")||s.hasClass("fc-unavailable")||i.hasClass("fc-unavailable")?(t=(s.hasClass("fc-custom")||i.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.edit?"mr-2":"d-none",n=(s.hasClass("fc-custom")||i.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.delete?"mr-2":"d-none",$("<div/>",{html:[$("<strong/>",{class:"d-inline-block mr-2",text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.start.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.end.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.notes}),$("<span/>",{text:l(e)}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary "+n,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+t,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]})):$(this).hasClass("fc-working-plan-exception")||s.hasClass("fc-working-plan-exception")||i.hasClass("fc-working-plan-exception")?(n=(s.hasClass("fc-custom")||i.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.deletdeletee?"mr-2":"d-none",$("<div/>",{html:[$("<strong/>",{class:"d-inline-block mr-2",text:EALang.provider}),$("<span/>",{text:e.data?e.data.provider.first_name+" "+e.data.provider.last_name:"-"}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.start.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.end.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.timezone}),$("<span/>",{text:GlobalVariables.timezones[e.data.provider.timezone]}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-between",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary "+n,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+t,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]})):(t=!0===GlobalVariables.user.privileges.appointments.edit?"mr-2":"d-none",n=!0===GlobalVariables.user.privileges.appointments.delete?"mr-2":"d-none",$("<div/>",{html:[$("<strong/>",{class:"d-inline-block mr-2",text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.start.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.end.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.timezone}),$("<span/>",{text:GlobalVariables.timezones[e.data.provider.timezone]}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.service}),$("<span/>",{text:e.data.service.name}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.provider}),GeneralFunctions.renderMapIcon(e.data.provider),$("<span/>",{text:e.data.provider.first_name+" "+e.data.provider.last_name}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.customer}),GeneralFunctions.renderMapIcon(e.data.customer),$("<span/>",{class:"d-inline-block ml-1",text:e.data.customer.first_name+" "+e.data.customer.last_name}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.email}),GeneralFunctions.renderMailIcon(e.data.customer.email),$("<span/>",{class:"d-inline-block ml-1",text:e.data.customer.email}),$("<br/>"),$("<strong/>",{class:"d-inline-block mr-2",text:EALang.phone}),GeneralFunctions.renderPhoneIcon(e.data.customer.phone_number),$("<span/>",{class:"d-inline-block ml-1",text:e.data.customer.phone_number}),$("<br/>"),$("<strong/>",{text:EALang.notes}),$("<span/>",{text:l(e)}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary "+n,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+t,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]}));$(a.target).popover({placement:"top",title:e.title,content:r,html:!0,container:"#calendar",trigger:"manual"}),b=e,$(a.target).popover("toggle"),0<$(".popover").length&&$(".popover").position().top<200&&$(".popover").css("top","200px")}function y(t,n,s){if(!1===GlobalVariables.user.privileges.appointments.edit)return s(),void Backend.displayNotification(EALang.no_privileges_edit_appointments);var e,i,r,a=$("#calendar");$("#notification").is(":visible")&&$("#notification").hide("bind"),!1===Boolean(Number(t.data.is_unavailable))?(t.data.end_datetime=Date.parseExact(t.data.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:n.days(),hours:n.hours(),minutes:n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),delete(i=GeneralFunctions.clone(t.data)).customer,delete i.provider,delete i.service,e=function(){Backend.displayNotification(EALang.appointment_updated,[{label:EALang.undo,function:function(){i.end_datetime=t.data.end_datetime=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-n.days(),hours:-n.hours(),minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss");var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_appointment",a={csrfToken:GlobalVariables.csrfToken,appointment_data:JSON.stringify(i)};$.post(e,a).done(function(){$("#notification").hide("blind")}),s()}}]),$("#footer").css("position","static"),a.fullCalendar("updateEvent",t)},BackendCalendarApi.saveAppointment(i,null,e)):(r={id:t.data.id,start_datetime:t.start.format("YYYY-MM-DD HH:mm:ss"),end_datetime:t.end.format("YYYY-MM-DD HH:mm:ss"),id_users_provider:t.data.id_users_provider},t.data.end_datetime=r.end_datetime,e=function(){Backend.displayNotification(EALang.unavailable_updated,[{label:EALang.undo,function:function(){r.end_datetime=t.data.end_datetime=Date.parseExact(r.end_datetime,"yyyy-MM-dd HH:mm:ss").add({minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss");var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_unavailable",a={csrfToken:GlobalVariables.csrfToken,unavailable:JSON.stringify(r)};$.post(e,a).done(function(){$("#notification").hide("blind")}),s()}}]),$("#footer").css("position","static"),a.fullCalendar("updateEvent",t)},BackendCalendarApi.saveUnavailable(r,e,null))}function E(){$("#calendar").fullCalendar("option","height",v())}function h(e){e.hasTime()||($("#calendar").fullCalendar("changeView","agendaDay"),$("#calendar").fullCalendar("gotoDate",e))}function _(t,n,s){if(!1===GlobalVariables.user.privileges.appointments.edit)return s(),void Backend.displayNotification(EALang.no_privileges_edit_appointments);var i,r,e;$("#notification").is(":visible")&&$("#notification").hide("bind"),"0"===t.data.is_unavailable?(delete(i=GeneralFunctions.clone(t.data)).customer,delete i.provider,delete i.service,i.start_datetime=Date.parseExact(i.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:n.days(),hours:n.hours(),minutes:n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),i.end_datetime=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:n.days(),hours:n.hours(),minutes:n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),t.data.start_datetime=i.start_datetime,t.data.end_datetime=i.end_datetime,e=function(){Backend.displayNotification(EALang.appointment_updated,[{label:EALang.undo,function:function(){i.start_datetime=Date.parseExact(i.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-n.days(),hours:-n.hours(),minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),i.end_datetime=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-n.days(),hours:-n.hours(),minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),t.data.start_datetime=i.start_datetime,t.data.end_datetime=i.end_datetime;var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_appointment",a={csrfToken:GlobalVariables.csrfToken,appointment_data:JSON.stringify(i)};$.post(e,a).done(function(){$("#notification").hide("blind")}),s()}}]),$("#footer").css("position","static")},BackendCalendarApi.saveAppointment(i,null,e)):(r={id:t.data.id,start_datetime:t.start.format("YYYY-MM-DD HH:mm:ss"),end_datetime:t.end.format("YYYY-MM-DD HH:mm:ss"),id_users_provider:t.data.id_users_provider},e=function(){Backend.displayNotification(EALang.unavailable_updated,[{label:EALang.undo,function:function(){r.start_datetime=Date.parseExact(r.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-n.days(),minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),r.end_datetime=Date.parseExact(r.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-n.days(),minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),t.data.start_datetime=r.start_datetime,t.data.end_datetime=r.end_datetime;var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_unavailable",a={csrfToken:GlobalVariables.csrfToken,unavailable:JSON.stringify(r)};$.post(e,a).done(function(){$("#notification").hide("blind")}),s()}}]),$("#footer").css("position","static")},BackendCalendarApi.saveUnavailable(r,e))}function D(){null!==$("#select-filter-item").val()&&(A($("#calendar"),$("#select-filter-item").val(),$("#select-filter-item option:selected").attr("type"),$("#calendar").fullCalendar("getView").start,$("#calendar").fullCalendar("getView").end),$(window).trigger("resize"),$(".close-popover").each(function(e,a){$(a).parents(".popover").popover("dispose")}),$(".fv-events").each(function(e,a){$(a).popover()}))}function k(){$(".fc-custom").each(function(e,a){var t=$(a).find(".fc-event-title").text();$(a).find(".fc-event-title").html(t);var n=$(a).find(".fc-event-time").text();$(a).find(".fc-event-time").html(n)})}function A(e,H,G,a,t){var n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_get_calendar_appointments",s={csrfToken:GlobalVariables.csrfToken,record_id:H,start_date:a.format("YYYY-MM-DD"),end_date:t.format("YYYY-MM-DD"),filter_type:G};return $("#loading").css("visibility","hidden"),$.post(n,s).done(function(e){var s=$("#calendar");s.fullCalendar("removeEvents");var t=[];e.appointments.forEach(function(e){var a={id:e.id,title:e.service.name+" - "+e.customer.first_name+" "+e.customer.last_name,start:moment(e.start_datetime),end:moment(e.end_datetime),allDay:!1,data:e};t.push(a)}),s.fullCalendar("addEventSource",t);var n=[];e.unavailables.forEach(function(e){var a=e.notes?" - "+e.notes:"";e.notes&&30<e.notes.length&&(a=e.notes.substring(0,30)+"...");var t={title:EALang.unavailable+a,start:moment(e.start_datetime),end:moment(e.end_datetime),allDay:!1,color:"#879DB4",editable:!1,className:"fc-unavailable fc-custom",data:e};n.push(t)}),s.fullCalendar("addEventSource",n);var i=[];e.pendings&&e.pendings.forEach(function(e){var a=e.notes?" - "+e.notes:"";e.notes&&30<e.notes.length&&(a=e.notes.substring(0,30)+"...");var t={title:"Pending Approval"+a,start:moment(e.start_datetime),end:moment(e.end_datetime),allDay:!1,color:"#F85A40",editable:!1,className:"fc-pending-approval fc-custom",data:e};i.push(t)}),s.fullCalendar("addEventSource",i);var a=$("#calendar").fullCalendar("getView");if(G===w&&"month"!==a.name){var r=GlobalVariables.availableProviders.find(function(e){return Number(e.id)===Number(H)});if(!r)throw new Error("Provider was not found.");var l,o,d,c,m,p,u,b,f,v,g,y,E=JSON.parse(r.settings.working_plan),h=JSON.parse(r.settings.working_plan_exceptions),_=GeneralFunctions.getWeekDayId(GlobalVariables.firstWeekday),D=GeneralFunctions.sortWeekDictionary(E,_);switch(a.name){case"agendaDay":if(u=parseInt(a.start.format("d")),b=GeneralFunctions.getWeekdayName(u),f=a.start.clone().format("YYYY-MM-DD"),h&&h[f]&&(D[b]=h[f],m=f+" "+D[b].start,p=f+" "+D[b].end,v={title:EALang.working_plan_exception,start:moment(m,"YYYY-MM-DD HH:mm",!0),end:moment(p,"YYYY-MM-DD HH:mm",!0).add(1,"day"),allDay:!0,color:"#879DB4",editable:!1,className:"fc-working-plan-exception fc-custom",data:{date:f,workingPlanException:h[f],provider:r}},s.fullCalendar("renderEvent",v,!1)),null===D[b])return l={title:EALang.not_working,start:a.intervalStart.clone(),end:a.intervalEnd.clone(),allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},void s.fullCalendar("renderEvent",l,!1);var k,A,x,Y=moment(a.start.format("YYYY-MM-DD")+" 00:00:00"),M=D[b].start.split(":");(x=Y.clone()).hour(parseInt(M[0])),x.minute(parseInt(M[1])),Y<x&&(k={title:EALang.not_working,start:Y,end:x,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},s.fullCalendar("renderEvent",k,!1)),o=moment(a.end.format("YYYY-MM-DD")+" 00:00:00"),g=D[b].end.split(":"),(y=Y.clone()).hour(parseInt(g[0])),y.minute(parseInt(g[1])),y<o&&(A={title:EALang.not_working,start:y,end:o,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},s.fullCalendar("renderEvent",A,!1)),D[b].breaks.forEach(function(e){var a=e.start.split(":");(d=Y.clone()).hour(parseInt(a[0])),d.minute(parseInt(a[1]));var t=e.end.split(":");(c=Y.clone()).hour(parseInt(t[0])),c.minute(parseInt(t[1]));var n={title:EALang.break,start:d,end:c,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable fc-break"};s.fullCalendar("renderEvent",n,!1)});break;case"agendaWeek":for(var L=a.start.clone();L<a.end;)u=parseInt(L.format("d")),b=GeneralFunctions.getWeekdayName(u),f=L.format("YYYY-MM-DD"),h&&h[f]&&(D[b]=h[f],m=f+" "+D[b].start,p=f+" "+D[b].end,v={title:EALang.working_plan_exception,start:moment(m,"YYYY-MM-DD HH:mm",!0),end:moment(p,"YYYY-MM-DD HH:mm",!0).add(1,"day"),allDay:!0,color:"#879DB4",editable:!1,className:"fc-working-plan-exception fc-custom",data:{date:f,workingPlanException:h[f],provider:r}},s.fullCalendar("renderEvent",v,!1)),null!==D[b]?(M=D[b].start.split(":"),(x=L.clone()).hour(parseInt(M[0])),x.minute(parseInt(M[1])),L<x&&(l={title:EALang.not_working,start:L.clone(),end:moment(L.format("YYYY-MM-DD")+" "+D[b].start+":00"),allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},s.fullCalendar("renderEvent",l,!0)),g=D[b].end.split(":"),(y=L.clone()).hour(parseInt(g[0])),y.minute(parseInt(g[1])),a.end>y&&(l={title:EALang.not_working,start:moment(L.format("YYYY-MM-DD")+" "+D[b].end+":00"),end:L.clone().add(1,"day"),allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},s.fullCalendar("renderEvent",l,!1)),D[b].breaks.forEach(function(e){var a=e.start.split(":");(d=L.clone()).hour(parseInt(a[0])),d.minute(parseInt(a[1]));var t=e.end.split(":");(c=L.clone()).hour(parseInt(t[0])),c.minute(parseInt(t[1]));var n={title:EALang.break,start:moment(L.format("YYYY-MM-DD")+" "+e.start),end:moment(L.format("YYYY-MM-DD")+" "+e.end),allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable fc-break"};s.fullCalendar("renderEvent",n,!1)})):(l={title:EALang.not_working,start:L.clone(),end:L.clone().add(1,"day"),allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},s.fullCalendar("renderEvent",l,!0)),L.add(1,"day")}}}).always(function(){$("#loading").css("visibility","")})}e.initialize=function(){var e={};switch(GlobalVariables.dateFormat){case"DMY":e="ddd D/M";break;case"MDY":case"YMD":e="ddd M/D";break;default:throw new Error("Invalid date format setting provided!",GlobalVariables.dateFormat)}var a="",t="";switch(GlobalVariables.timeFormat){case"military":a="H:mm",t="H(:mm)";break;case"regular":a="h:mm a",t="h(:mm) a";break;default:throw new Error("Invalid time format setting provided!",GlobalVariables.timeFormat)}var n,s,i,r,l,o,d=window.innerWidth<468?"agendaDay":"agendaWeek",c=GlobalVariables.firstWeekday,m=GeneralFunctions.getWeekDayId(c);$("#calendar").fullCalendar({defaultView:d,height:v(),editable:!0,firstDay:m,snapDuration:"00:15:00",timeFormat:a,slotLabelFormat:t,allDayText:EALang.all_day,columnFormat:e,header:{left:"prev,next today",center:"title",right:"agendaDay,agendaWeek,month"},selectable:!0,selectHelper:!0,select:function(e,a){var t,n;if(e.hasTime()&&a.hasTime())return $("#insert-appointment").trigger("click"),$("#select-filter-item option:selected").attr("type")===f?(n=GlobalVariables.availableServices.find(function(e){return Number(e.id)===Number($("#select-filter-item").val())}),$("#select-service").val(n.id).trigger("change")):(t=GlobalVariables.availableProviders.find(function(e){return Number(e.id)===Number($("#select-filter-item").val())}),(n=GlobalVariables.availableServices.find(function(e){return-1!==t.services.indexOf(e.id)}))&&$("#select-service").val(n.id),$("#select-service").val()||$("#select-service option:first").prop("selected",!0),$("#select-service").trigger("change"),t&&$("#select-provider").val(t.id),$("#select-provider").val()||$("#select-provider option:first").prop("selected",!0),$("#select-provider").trigger("change")),$("#start-datetime").datepicker("setDate",new Date(e.format("YYYY/MM/DD HH:mm:ss"))),$("#end-datetime").datepicker("setDate",new Date(a.format("YYYY/MM/DD HH:mm:ss"))),!1},monthNames:[EALang.january,EALang.february,EALang.march,EALang.april,EALang.may,EALang.june,EALang.july,EALang.august,EALang.september,EALang.october,EALang.november,EALang.december],monthNamesShort:[EALang.january.substr(0,3),EALang.february.substr(0,3),EALang.march.substr(0,3),EALang.april.substr(0,3),EALang.may.substr(0,3),EALang.june.substr(0,3),EALang.july.substr(0,3),EALang.august.substr(0,3),EALang.september.substr(0,3),EALang.october.substr(0,3),EALang.november.substr(0,3),EALang.december.substr(0,3)],dayNames:[EALang.sunday,EALang.monday,EALang.tuesday,EALang.wednesday,EALang.thursday,EALang.friday,EALang.saturday],dayNamesShort:[EALang.sunday.substr(0,3),EALang.monday.substr(0,3),EALang.tuesday.substr(0,3),EALang.wednesday.substr(0,3),EALang.thursday.substr(0,3),EALang.friday.substr(0,3),EALang.saturday.substr(0,3)],dayNamesMin:[EALang.sunday.substr(0,2),EALang.monday.substr(0,2),EALang.tuesday.substr(0,2),EALang.wednesday.substr(0,2),EALang.thursday.substr(0,2),EALang.friday.substr(0,2),EALang.saturday.substr(0,2)],buttonText:{today:EALang.today,day:EALang.day,week:EALang.week,month:EALang.month},windowResize:E,viewRender:D,dayClick:h,eventClick:g,eventResize:y,eventDrop:_,eventAfterAllRender:k}),E(),0<GlobalVariables.availableProviders.length&&$("<optgroup/>",{label:EALang.providers,type:"providers-group",html:GlobalVariables.availableProviders.map(function(e){var a="1"===e.settings.google_sync?"true":"false";return $("<option/>",{value:e.id,type:w,"google-sync":a,text:e.first_name+" "+e.last_name})})}).appendTo("#select-filter-item"),0<GlobalVariables.availableServices.length&&$("<optgroup/>",{label:EALang.services,type:"services-group",html:GlobalVariables.availableServices.map(function(e){return $("<option/>",{value:e.id,type:f,text:e.name})})}).appendTo("#select-filter-item"),GlobalVariables.user.role_slug===Backend.DB_SLUG_PROVIDER&&($("#select-filter-item optgroup:eq(0)").find('option[value="'+GlobalVariables.user.id+'"]').prop("selected",!0),$("#select-filter-item").prop("disabled",!0)),GlobalVariables.user.role_slug===Backend.DB_SLUG_SECRETARY&&($("#select-filter-item optgroup:eq(1)").remove(),$('#select-filter-item option[type="provider"]').each(function(e,a){GlobalVariables.secretaryProviders.find(function(e){return Number($(a).val())===Number(e)})||$(a).remove()}),$('#select-filter-item option[type="provider"]').length||$('#select-filter-item optgroup[type="providers-group"]').remove()),n=$("#calendar-page"),$("#reload-appointments").on("click",function(){var e=$("#calendar").fullCalendar("getView");A($("#calendar"),$("#select-filter-item").val(),$("#select-filter-item").find("option:selected").attr("type"),e.start,e.end)}),n.on("click",".close-popover",function(){$(this).parents(".popover").popover("dispose")}),n.on("click",".edit-popover",function(){var e,a,t,n,i,s,r,l,o;$(this).parents(".popover").popover("dispose"),b.data.workingPlanException?(t=b.data.date,n=b.data.workingPlanException,i=b.data.provider,WorkingPlanExceptionsModal.edit(t,n).done(function(n,s){BackendCalendarApi.saveWorkingPlanException(n,s,i.id,function(){Backend.displayNotification(EALang.working_plan_exception_saved);var e=JSON.parse(i.settings.working_plan_exceptions)||{};for(var a in e[n]=s,GlobalVariables.availableProviders){var t=GlobalVariables.availableProviders[a];if(Number(t.id)===Number(i.id)){t.settings.working_plan_exceptions=JSON.stringify(e);break}}$("#select-filter-item").trigger("change")},null)})):"fc-pending-approval"==b.className[0]?(o=b.data,BackendCalendarApi.aproveUnavailable(o,function(){Backend.displayNotification("Approved Unavailable Time"),$("#select-filter-item").trigger("change")},null)):"0"===b.data.is_unavailable?(s=b.data,r=$("#manage-appointment"),BackendCalendarAppointmentsModal.resetAppointmentDialog(),r.find(".modal-header h3").text(EALang.edit_appointment_title),r.find("#appointment-id").val(s.id),r.find("#select-service").val(s.id_services).trigger("change"),r.find("#select-provider").val(s.id_users_provider),e=Date.parseExact(s.start_datetime,"yyyy-MM-dd HH:mm:ss"),r.find("#start-datetime").datetimepicker("setDate",e),a=Date.parseExact(s.end_datetime,"yyyy-MM-dd HH:mm:ss"),r.find("#end-datetime").datetimepicker("setDate",a),l=s.customer,r.find("#customer-id").val(s.id_users_customer),r.find("#first-name").val(l.first_name),r.find("#last-name").val(l.last_name),r.find("#email").val(l.email),r.find("#phone-number").val(l.phone_number),r.find("#address").val(l.address),r.find("#city").val(l.city),r.find("#zip-code").val(l.zip_code),r.find("#appointment-location").val(s.location),r.find("#appointment-notes").val(s.notes),r.find("#customer-notes").val(l.notes),"admin"==GlobalVariables.user.role_slug&&r.modal("show")):((o=b.data).start_datetime=b.start.format("YYYY-MM-DD HH:mm:ss"),e=Date.parseExact(o.start_datetime,"yyyy-MM-dd HH:mm:ss"),o.end_datetime=b.end.format("YYYY-MM-DD HH:mm:ss"),a=Date.parseExact(o.end_datetime,"yyyy-MM-dd HH:mm:ss"),r=$("#manage-unavailable"),BackendCalendarUnavailabilityEventsModal.resetUnavailableDialog(),r.find(".modal-header h3").text("Edit Unavailable Period"),r.find("#unavailable-start").datetimepicker("setDate",e),r.find("#unavailable-id").val(o.id),r.find("#unavailable-provider").val(o.id_users_provider),r.find("#unavailable-end").datetimepicker("setDate",a),r.find("#unavailable-notes").val(o.notes),r.modal("show"))}),n.on("click",".delete-popover",function(){var e,a,t,n;if($(this).parents(".popover").popover("dispose"),b.data.workingPlanException){var s=$("#select-filter-item").val(),i=GlobalVariables.availableProviders.find(function(e){return Number(e.id)===Number(s)});if(!i)throw new Error("Provider could not be found: "+s);var r=function(){Backend.displayNotification(EALang.working_plan_exception_deleted);var e=JSON.parse(i.settings.working_plan_exceptions)||{};for(var a in delete e[l],GlobalVariables.availableProviders){var t=GlobalVariables.availableProviders[a];if(Number(t.id)===Number(s)){t.settings.working_plan_exceptions=JSON.stringify(e);break}}$("#select-filter-item").trigger("change")},l=b.start.format("YYYY-MM-DD");BackendCalendarApi.deleteWorkingPlanException(l,s,r)}else{"fc-pending-approval"==b.className[0]?(t=b.data,r=function(){Backend.displayNotification("Deleted Unavailable Time"),$("#select-filter-item").trigger("change")},BackendCalendarApi.deleteUnApproved(t,r,null)):"0"===b.data.is_unavailable?(n=[{text:EALang.cancel,click:function(){$("#message-box").dialog("close")}},{text:"OK",click:function(){e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_appointment",a={csrfToken:GlobalVariables.csrfToken,appointment_id:b.data.id,delete_reason:$("#delete-reason").val()},$.post(e,a).done(function(){$("#message-box").dialog("close"),$("#select-filter-item").trigger("change")})}}],GeneralFunctions.displayMessageBox(EALang.delete_appointment_title,EALang.write_appointment_removal_reason,n),$("<textarea/>",{class:"form-control w-100",id:"delete-reason",rows:"3"}).appendTo("#message-box")):(e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_unavailable",a={csrfToken:GlobalVariables.csrfToken,unavailable_id:b.data.id},$.post(e,a).done(function(){$("#message-box").dialog("close"),$("#select-filter-item").trigger("change")}))}}),$("#select-filter-item").on("change",function(){var a,e;$("#select-filter-item option:selected").attr("type")===f?($("#google-sync, #enable-sync, #insert-appointment, #insert-dropdown").prop("disabled",!0),$("#calendar").fullCalendar("option",{selectable:!1,editable:!1})):($("#google-sync, #enable-sync, #insert-appointment, #insert-dropdown").prop("disabled",!1),$("#calendar").fullCalendar("option",{selectable:!0,editable:!0}),a=$("#select-filter-item").val(),(e=GlobalVariables.availableProviders.find(function(e){return Number(e.id)===Number(a)}))&&e.timezone&&$(".provider-timezone").text(GlobalVariables.timezones[e.timezone]),"true"===$("#select-filter-item option:selected").attr("google-sync")?($("#enable-sync").removeClass("btn-light").addClass("btn-secondary enabled"),$("#enable-sync span").text(EALang.disable_sync),$("#google-sync").prop("disabled",!1)):($("#enable-sync").removeClass("btn-secondary enabled").addClass("btn-light"),$("#enable-sync span").text(EALang.enable_sync),$("#google-sync").prop("disabled",!0)))}),$("#select-filter-item").trigger("change"),GlobalVariables.editAppointment&&(s=$("#manage-appointment"),i=GlobalVariables.editAppointment,BackendCalendarAppointmentsModal.resetAppointmentDialog(),s.find(".modal-header h3").text(EALang.edit_appointment_title),s.find("#appointment-id").val(i.id),s.find("#select-service").val(i.id_services).trigger("change"),s.find("#select-provider").val(i.id_users_provider),r=Date.parseExact(i.start_datetime,"yyyy-MM-dd HH:mm:ss"),s.find("#start-datetime").datetimepicker("setDate",r),l=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss"),s.find("#end-datetime").datetimepicker("setDate",l),o=i.customer,s.find("#customer-id").val(i.id_users_customer),s.find("#first-name").val(o.first_name),s.find("#last-name").val(o.last_name),s.find("#email").val(o.email),s.find("#phone-number").val(o.phone_number),s.find("#address").val(o.address),s.find("#city").val(o.city),s.find("#zip-code").val(o.zip_code),s.find("#appointment-location").val(i.location),s.find("#appointment-notes").val(i.notes),s.find("#customer-notes").val(o.notes),"admin"==GlobalVariables.user.role_slug&&s.modal("show")),$("#select-filter-item option").length||$("#calendar-actions button").prop("disabled",!0),window.innerHeight<700&&$("#footer").css("position","static");var p=$("#calendar"),u=$("#select-filter-item");setInterval(function(){var e=p.fullCalendar("getView");A(0,u.val(),u.find("option:selected").attr("type"),e.start,e.end)},6e4)}}(window.BackendCalendarDefaultView);