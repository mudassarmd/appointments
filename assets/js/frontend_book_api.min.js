window.FrontendBookApi=window.FrontendBookApi||{},function(a){"use strict";var i,l,s=!1;a.getAvailableHours=function(i){$("#available-hours").empty();var e=$("#select-service").val(),a=60,t=GlobalVariables.availableServices.find(function(a){return Number(a.id)===Number(e)});t&&(a=t.duration);var o=FrontendBook.manageMode?GlobalVariables.appointmentData.id:null,n=GlobalVariables.baseUrl+"/index.php/appointments/ajax_get_available_hours",r={csrfToken:GlobalVariables.csrfToken,service_id:$("#select-service").val(),provider_id:$("#select-provider").val(),selected_date:i,service_duration:a,manage_mode:FrontendBook.manageMode,appointment_id:o};$.post(n,r).done(function(a){if(0<a.length){var e=$("#select-provider").val();"any-provider"===e&&(e=GlobalVariables.availableProviders[0].id);var t=GlobalVariables.availableProviders.find(function(a){return Number(e)===Number(a.id)});if(!t)throw new Error("Could not find provider.");var o=t.timezone,n=$("#select-timezone").val(),r="regular"===GlobalVariables.timeFormat?"h:mm a":"HH:mm";a.forEach(function(a){var e=moment.tz(i+" "+a+":00",o).tz(n);$("#available-hours").append($("<button/>",{class:"btn btn-outline-secondary btn-block shadow-none available-hour",data:{value:a},text:e.format(r)}))}),FrontendBook.manageMode?$(".available-hour").removeClass("selected-hour").filter(function(){return $(this).text()===Date.parseExact(GlobalVariables.appointmentData.start_datetime,"yyyy-MM-dd HH:mm:ss").toString(r)}).addClass("selected-hour"):$(".available-hour:eq(0)").addClass("selected-hour"),FrontendBook.updateConfirmFrame()}else $("#available-hours").text(EALang.no_available_hours)})},a.registerAppointment=function(){var e=$(".captcha-text");if(!(0<e.length&&(e.closest(".form-group").removeClass("has-error"),""===e.val()))){var a=JSON.parse($('input[name="post_data"]').val()),t={csrfToken:GlobalVariables.csrfToken,post_data:a};0<e.length&&(t.captcha=e.val()),GlobalVariables.manageMode&&(t.exclude_appointment_id=GlobalVariables.appointmentData.id);var o=GlobalVariables.baseUrl+"/index.php/appointments/ajax_register_appointment",n=$("<div/>"),r="";return $.ajax({url:o,method:"post",data:t,dataType:"json",async:!1,beforeSend:function(a,e){n.appendTo("body").css({background:"white",position:"fixed",top:"0",left:"0",height:"100vh",width:"100vw",opacity:"0.5"})}}).done(function(a){if(!1===a.captcha_verification)return $("#captcha-hint").text(EALang.captcha_is_wrong).fadeTo(400,1),setTimeout(function(){$("#captcha-hint").fadeTo(400,0)},3e3),$(".captcha-title button").trigger("click"),e.closest(".form-group").addClass("has-error"),!1;r=a.appointment_hash}).fail(function(a,e,t){$(".captcha-title button").trigger("click")}).always(function(){n.remove()}),d(r)}e.closest(".form-group").addClass("has-error")};var d=function(a){var e=$(".captcha-text");if(!(0<e.length&&(e.closest(".form-group").removeClass("has-error"),""===e.val()))){var t={provider_id:$("#provider-pay").val(),service_id:$("#service-pay").val(),time_slot:$("#date-pay").val(),currency_code:"",item_name:$("#teacher-name").text()+", "+$("#subject-name").text(),total_amount:parseFloat($("#tot-price-pay").val().trim()),customer_id:"1",hash:a},o={csrfToken:GlobalVariables.csrfToken,post_data:t};0<e.length&&(o.captcha=e.val()),GlobalVariables.manageMode&&(o.exclude_appointment_id=GlobalVariables.appointmentData.id);var n=GlobalVariables.baseUrl+"/index.php/appointments/processPayment",r=$("<div/>"),i="";return $.ajax({url:n,method:"post",data:o,dataType:"json",async:!1,beforeSend:function(a,e){r.appendTo("body").css({background:"white",position:"fixed",top:"0",left:"0",height:"100vh",width:"100vw",opacity:"0.5"})}}).done(function(a){if(!1===a.captcha_verification)return $("#captcha-hint").text(EALang.captcha_is_wrong).fadeTo(400,1),setTimeout(function(){$("#captcha-hint").fadeTo(400,0)},3e3),$(".captcha-title button").trigger("click"),e.closest(".form-group").addClass("has-error"),!1;i=a.response_html}).fail(function(a,e,t){$(".captcha-title button").trigger("click")}).always(function(){r.remove()}),i}e.closest(".form-group").addClass("has-error")};function c(t,a,e){e=e||!1,s=!0;var o=Date.parse(a),n=new Date(o.getFullYear(),o.getMonth()+1,0).getDate();if(e&&!GlobalVariables.manageMode)for(var r=1;r<=n;r++){var i=new Date(o.getFullYear(),o.getMonth(),r);if(-1===t.indexOf(i.toString("yyyy-MM-dd"))){$("#select-date").datepicker("setDate",i),FrontendBookApi.getAvailableHours(i.toString("yyyy-MM-dd"));break}}t.length===n&&$("#available-hours").text(EALang.no_available_hours),$("#select-date .ui-datepicker-calendar td:not(.ui-datepicker-other-month)").each(function(a,e){o.set({day:a+1}),-1!==t.indexOf(o.toString("yyyy-MM-dd"))&&$(e).addClass("ui-datepicker-unselectable ui-state-disabled")}),s=!1}a.getUnavailableDates=function(a,e,t){var o,n,r;s||a&&e&&(o=FrontendBook.manageMode?GlobalVariables.appointmentData.id:null,n=GlobalVariables.baseUrl+"/index.php/appointments/ajax_get_unavailable_dates",r={provider_id:a,service_id:e,selected_date:encodeURIComponent(t),csrfToken:GlobalVariables.csrfToken,manage_mode:FrontendBook.manageMode,appointment_id:o},$.ajax({url:n,type:"GET",data:r,dataType:"json"}).done(function(a){c(i=a,l=t,!0)}))},a.applyPreviousUnavailableDates=function(){c(i,l)},a.saveConsent=function(a){var e=GlobalVariables.baseUrl+"/index.php/consents/ajax_save_consent",t={csrfToken:GlobalVariables.csrfToken,consent:a};$.post(e,t)},a.deletePersonalInformation=function(a){var e=GlobalVariables.baseUrl+"/index.php/privacy/ajax_delete_personal_information",t={csrfToken:GlobalVariables.csrfToken,customer_token:a};$.post(e,t).done(function(){window.location.href=GlobalVariables.baseUrl})}}(window.FrontendBookApi);